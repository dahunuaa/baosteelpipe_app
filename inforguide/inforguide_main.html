<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>inforguide_main</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css" />
		<style>
			html,
			body {
				background-color:#efeff4;
			}
			#middlePopover {
				height: 270px;
				width: 150px;
				text-align:center;
			}
			#reportPopover{
				height: 90px;
				width:150px;
				text-align:center;
			}
		</style>
   </head>
	<body>

		<div align="center" style="background-color:#FAFAFA">
			<input type="search" id="inforguide_search" class="mui-icon mui-icon-search" placeholder="请输入搜索内容" style="width:250px;height:35px; background-color:#E8E8E8; margin-top: 10px;margin-bottom: 5px;"/>
			<a id="inforguide_search"><span class="mui-icon mui-icon-search"></span></a>
			<hr>
		</div>
		<div class="mui-content" style=" margin-top:-23px;">
		        <ul class="mui-table-view mui-grid-view mui-grid-9">
		           <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
						<span class="mui-icon mui-icon-list" id="inforguide_list" style="margin: 3px; color:#2AC845;" ><span id="msg_remind"></span></span>
						<div class="mui-media-body" >指南列表</div>
				    </li>
				    <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
			                <span class="mui-icon mui-icon-compose" style="margin-top: 3px; font-size: 40px; color: #0062CC;" id="new_guide"></span>
			                <div class="mui-media-body">新建信息指南</div>
					</li>
				    <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
							<span class="mui-icon mui-icon-star" style="margin-top: 3px;color: red;" id="like"></span>
							<div class="mui-media-body">我的收藏</div>
				    </li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
			                <span class="mui-icon-extra mui-icon-extra-trend" style="margin-top: 3px; font-size: 40px; color: #0062CC;" id="statistic"></span>
			                <div class="mui-media-body">数据统计</div>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
							<a href="#middlePopover"><span class="mui-icon-extra mui-icon-extra-filter"id="rapid_search" style="margin-top: -10px;font-size: 35px;color: green;"></span></a>
							<div class="mui-media-body" >快速查询</div>
								</a>
					</li>
			        <li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
			                <a href="#reportPopover"><span class="mui-icon-extra mui-icon-extra-topic" style="margin-top: -10px; font-size: 35px; color: #0062CC;" id="report"></span></a>
			                <div class="mui-media-body">报表导出</div>
			        </li>
		        </ul> 
		</div>
		<div id="middlePopover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell"><a href="#" id="my_inforguide">我的信息指南</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" id="bijixiaojie">笔记小结</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" id="yonghuxinxi">用户信息</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" id="chanpinxinxi">产品信息</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" id="hangyexinxi">行业信息</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" id="gongsixinwen">公司新闻</a>
						</li>
						
					</ul>
				</div>
			</div>

		</div>
		<div id="reportPopover" class="mui-popover">
			<div class="mui-popover-arrow"></div>
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell"><a href="#" id="download">下载报表</a>
						</li>
						<li class="mui-table-view-cell"><a href="#" id="open">打开报表</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		
	    <script src="../js/mui.min.js"></script>
		<script src="../js/app.js"></script>
		<script type="text/javascript" src="../js/basepath.js" ></script>
		<script>
		(function($,doc){
			$.init();
			
			$.plusReady(function(){
			var inforguide_list = document.getElementById("inforguide_list")
			inforguide_list.addEventListener('tap',function(event){
				mui.openWindow({
					url:"inforguide_main_base.html",
					id:"inforguide_main_base",
				})
				})
			//新建信息指南
			document.getElementById("new_guide").addEventListener('tap',function(event){
				mui.openWindow({
					url:"newinformationguide.html",
					id:"newinformationguide",
				})
				})
			//快速查询
			document.getElementById("my_inforguide").addEventListener('tap',function(event){
				mui.openWindow({
					url:"myInformationGuiding.html",
					id:"myInformationGuiding",
				})
				})
			document.getElementById("bijixiaojie").addEventListener('tap',function(){
					localStorage.setItem("guide_type","笔记小结")
					mui.openWindow({
						url:"guide_type_list_base.html",
						id:"guide_type_list_base"
					})
				})
			
			document.getElementById("yonghuxinxi").addEventListener('tap',function(){
					localStorage.setItem("guide_type","用户信息")
						mui.openWindow({
							url:"guide_type_list_base.html",
							id:"guide_type_list_base"
						})
				})
			
			document.getElementById("chanpinxinxi").addEventListener('tap',function(){
					localStorage.setItem("guide_type","产品信息")
						mui.openWindow({
							url:"guide_type_list_base.html",
							id:"guide_type_list_base"
						})
				})
			
			document.getElementById("hangyexinxi").addEventListener('tap',function(){
					localStorage.setItem("guide_type","行业信息")
						mui.openWindow({
							url:"guide_type_list_base.html",
							id:"guide_type_list_base"
						})
				})
			
			document.getElementById("gongsixinwen").addEventListener('tap',function(){
					localStorage.setItem("guide_type","公司新闻")
						mui.openWindow({
							url:"guide_type_list_base.html",
							id:"guide_type_list_base"
						})
				})
			
				
			var inforguide_search=document.getElementById("inforguide_search")
				inforguide_search.addEventListener("tap",function(event){
					mui.openWindow({
						url:"inforguide_search.html",
						id:"inforguide_search"
					})
				})
				
			var guide_like = document.getElementById("like")
			guide_like.addEventListener('tap',function(event){
				mui.openWindow({
					url:"inforguide_like_base.html",
					id:"inforguide_like_base"
				})
			})
			
			var statistic = document.getElementById("statistic")
			statistic.addEventListener('tap',function(event){
				mui.openWindow({
					url:"statistic.html",
					id:"statistic"
				})
			})
			
			
			var dtask=null;
				var file_name="";
				var download = document.getElementById("download")
				download.addEventListener('tap',function(event){
					mui.ajax({
							type:"get",
							url:basepath+"api/v1.0/report/inforguide?access_token="+localStorage.getItem("token"),
							async:false,
							dataType:"json",
							success:function(data){
								var download_path = data.response.data.download_path
								file_name = data.response.data.file_name
//								alert(download_path+"..."+file_name)
								
								var url = download_path;
							    var options = {method:"GET",file_name:"_doc/"+file_name};
								dtask = plus.downloader.createDownload(url, options);//目前这种方式仅支持网络文件，本地文件不可以
							    dtask.addEventListener( "statechanged", function(task,status){
//						    	alert(task.totalSize)
						    	if(!dtask){return;}
						    	switch(task.state) {
						    		case 1: // 开始
						    			plus.nativeUI.toast("开始下载...");			    			
						    		break;
						    		case 2: // 已连接到服务器
						    			plus.nativeUI.toast("开始下载...");
						    		break;
						    		case 3:	// 已接收到数据
										plus.nativeUI.toast("下载进度：" +task.downloadedSize+"/"+task.totalSize) 
						    			
						    		break;
						    		case 4:	// 下载完成			    			
//						    			plus.nativeUI.toast(parseInt(task.totalSize/1024)+"KB") 
						    			plus.nativeUI.toast("下载完成!点击打开报表，完成查看！");
						    		break;
						    	}
						    } );
			
						    dtask.start();
							},
							error:function(){
								plus.nativeUI.toast("服务器连接失败")
							}
						})
				})
				
				var openfile = document.getElementById("open")
				openfile.addEventListener('tap',function(event){
					plus.runtime.openFile("_doc/"+file_name,{},function(event){
						plus.nativeUI.toast("打开失败，请重新下载！")
				    })
				})
			});
		}(mui,document))
		</script>
	</body>
</html>
